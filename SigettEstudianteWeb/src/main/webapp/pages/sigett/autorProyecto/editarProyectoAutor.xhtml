<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xml:lang="es" lang="es">

    <body>

        <ui:composition template="./principalEstudiante.xhtml">     
            <ui:define name="title">
                <h:outputText value="#{msg['lbl.proyecto']}" />
            </ui:define>
            <ui:define name="content">
                <p:messages id="msm" showDetail="true"/> 
                <p:tabView id="datos" >
                    <p:ajax event="tabChange" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" 
                            update="fechaProrroga,act,avance,faltante,treeActividades,crearActividad,tblDocumentos,crearDocumentoProyecto,dgDirectores" listener="#{administrarProyectosAutor.onTabChange}"/>
                    <p:tab id="inicio" title="#{msg['lbl.informacion']}">
                        <p:panel header="#{msg['lbl.informacion']}" toggleable="true">
                            <h:panelGrid styleClass="panelgrid" rowClasses="rowpanelgrid" columnClasses="col-sm-2,col-sm-10" columns="2">
                                <h:outputLabel value="#{msg['lbl.tema']}:"/>
                                <h:outputText value="#{sessionProyectosAutor.autorProyecto.proyectoId.temaActual}"/>
                                <h:outputLabel value="#{msg['lbl.fecha']} #{msg['lbl.inicio']}:"/>
                                <h:outputText value="#{sessionProyectosAutor.autorProyecto.proyectoId.cronograma.fechaInicio}">
                                    <f:convertDateTime pattern="dd/MMMM/yyy"/>
                                </h:outputText>
                                <h:outputLabel value="#{msg['lbl.fechaCulminación']}:"/>
                                <h:outputText id="fechaProrroga" value="#{sessionProyectosAutor.autorProyecto.proyectoId.cronograma.fechaProrroga}">
                                    <f:convertDateTime pattern="dd/MMMM/yyy"/>
                                </h:outputText>
                                <h:outputLabel value="#{msg['lbl.estado']}:"/>
                                <h:outputText value="#{sessionProyectosAutor.autorProyecto.proyectoId.estadoProyectoId.nombre}"/>
                                <h:outputLabel value="#{msg['lbl.tipoProyecto']}:"/>
                                <h:panelGrid>
                                    <p:commandLink id="detalleTp" value="#{sessionProyectosAutor.autorProyecto.proyectoId.tipoProyectoId.nombre}"/>
                                    <p:overlayPanel appendToBody="false" styleClass="modal-sm" showEffect="blind" for="detalleTp"  hideEffect="fade">
                                        <h:panelGrid columns="2" styleClass="panelgrid" rowClasses="rowpanelgrid" columnClasses="col-sm-2,col-sm-10"  >
                                            <h:outputLabel value="#{msg['lbl.nombre']}:"/>
                                            <h:outputText value="#{sessionProyectosAutor.autorProyecto.proyectoId.tipoProyectoId.nombre}"/>
                                            <h:outputLabel value="#{msg['lbl.descripcion']}:"/>
                                            <h:outputText value="#{sessionProyectosAutor.autorProyecto.proyectoId.tipoProyectoId.descripcion}"/>
                                        </h:panelGrid>
                                    </p:overlayPanel>
                                </h:panelGrid>
                                <h:outputLabel value="#{msg['lbl.categoria']}:"/>
                                <h:panelGrid>
                                    <p:commandLink id="dc" value="#{sessionProyectosAutor.autorProyecto.proyectoId.catalogoProyectoId.nombre}"/>
                                    <p:overlayPanel appendToBody="false" at="top" styleClass="modal-sm" showEffect="blind" for="dc"  hideEffect="fade">
                                        <h:panelGrid columns="2" rowClasses="rowpanelgrid" columnClasses="col-sm-2,col-sm-10"  >
                                            <h:outputLabel value="#{msg['lbl.nombre']}:"/>
                                            <h:outputText value="#{sessionProyectosAutor.autorProyecto.proyectoId.catalogoProyectoId.nombre}"/>
                                            <h:outputLabel value="#{msg['lbl.descripcion']}:"/>
                                            <h:outputText value="#{sessionProyectosAutor.autorProyecto.proyectoId.catalogoProyectoId.descripcion}"/>
                                        </h:panelGrid>
                                    </p:overlayPanel>
                                </h:panelGrid>
                                <h:outputLabel value="#{msg['lbl.avance']}:"/>
                                <p:progressBar id="avance" styleClass="avance" labelTemplate="#{sessionProyectosAutor.autorProyecto.proyectoId.cronograma.avance}%" value="#{sessionProyectosAutor.autorProyecto.proyectoId.cronograma.avance}"/>
                                <h:outputLabel value="#{msg['lbl.faltante']}:"/>
                                <p:progressBar id="faltante" styleClass="faltante" labelTemplate="#{sessionProyectosAutor.autorProyecto.proyectoId.cronograma.faltante}%" value="#{sessionProyectosAutor.autorProyecto.proyectoId.cronograma.faltante}"/>
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <p:tab id="actividades" title="#{msg['lbl.actividades']}">
                        <p:poll interval="#{administrarProyectosAutor.intervalo}" listener="#{administrarActividades.buscarPorAutorProyecto(administrarActividades.criterioPorAutorProyecto, sessionEstudianteUsuario.estudianteUsuario.usuario, sessionProyectosAutor.autorProyecto.proyectoId.cronograma)}" update="treeActividades"/>
                        <p:panel id="act">
                            <p:panel rendered="#{administrarActividades.renderedBuscar}" toggleable="true" header="#{msg['lbl.buscar']} #{msg['lbl.por']} #{msg['lbl.criterio']}">
                                <h:panelGrid  styleClass="panelgrid" rowClasses="rowpanelgrid" columnClasses="col-sm-10,col-sm-1" columns="2">
                                    <p:inputText style="text-transform: none" value="#{administrarActividades.criterioPorAutorProyecto}" placeholder="#{msg['lbl.buscar']}"/>
                                    <p:commandButton update="treeActividades,:contenido:msm"  onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" icon="ui-icon-search" value="#{msg['lbl.buscar']}" action="#{administrarActividades.buscarPorAutorProyecto(administrarActividades.criterioPorAutorProyecto, sessionEstudianteUsuario.estudianteUsuario.usuario, sessionProyectosAutor.autorProyecto.proyectoId.cronograma)}"/>
                                </h:panelGrid>
                            </p:panel>  
                            <br/>
                            <p:panel id="pnlActividades" rendered="#{administrarActividades.renderedBuscar}" toggleable="true" header="#{msg['lbl.actividades']}">
                                <p:tree id="treeActividades" value="#{administrarActividades.rootPorAutorProyecto}" var="node" dynamic="true"  animate="true">
                                    <p:treeNode collapsedIcon="ui-icon-folder-collapsed" expandedIcon="ui-icon-folder-open">
                                        <h:panelGrid styleClass="panel-group" style="background: #fff;text-overflow: ellipsis!important" columns="8">
                                            <p:commandLink  onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" rendered="#{administrarActividades.renderedSubirNivel(node)}" update="@form" onclick="if (!confirm('¿#{msg['lbl.confirmSubirNivel']}?'))
                                                        return false;" action="#{administrarActividades.subirNivel(node,sessionEstudianteUsuario.estudianteUsuario.usuario,sessionProyectosAutor.autorProyecto.proyectoId.cronograma)}">
                                                <p:graphicImage  value="/resources/blacks/16x16/191.png"/>
                                                <f:param name="1" value="autor"/>
                                            </p:commandLink>
                                            <h:outputLabel title="#{node.estadoActividadId.nombre}"  styleClass="#{administrarActividades.styleEstadoActividad(node)}"/>
                                            <p:commandLink onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" rendered="#{administrarActividades.renderedBajarNivel(node)}" update=":seleccionarActividad,:dlgBajarNivelActividad" onclick="if (!confirm('¿#{msg['lbl.confirmBajarNivel']}?'))
                                                        return false;" action="#{administrarActividades.bajarNivel(node)}">
                                                <p:graphicImage   value="/resources/blacks/16x16/190.png"/>
                                            </p:commandLink>
                                            <p:commandLink rendered="#{administrarActividades.renderedEditarPorAutorProyecto}"  update=":editarActividad,:dlgActividad,:contenido:msm"  onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" disabled="#{administrarActividades.disabledEditar(node)}"  action="#{administrarActividades.editar(node,sessionEstudianteUsuario.estudianteUsuario.usuario,sessionProyectosAutor.autorProyecto.proyectoId)}" value="#{node.nombre}">
                                                <f:param name="1" value="editar-dlg"/>
                                            </p:commandLink>
                                            <h:outputText rendered="#{administrarActividades.renderedNoEditarPorAutorProyecto}" value="#{node.nombre}"/>
                                            <p:progressBar  labelTemplate="#{node.avance}%" value="#{node.avance}"/>
                                            <p:commandLink title="#{msg['lbl.agregar']} #{msg['lbl.subactividad']}"  onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" rendered="#{administrarActividades.renderedCrearSubActividad(node,sessionProyectosAutor.autorProyecto.proyectoId)}" update=":editarActividad,:contenido:msm" action="#{administrarActividades.crearSubActividad(node,sessionEstudianteUsuario.estudianteUsuario.usuario,sessionProyectosAutor.autorProyecto.proyectoId)}" >
                                                <p:graphicImage value="/resources/img/icon_addlink.gif"/>
                                                <f:param name="1" value="crear-dlg"/>
                                            </p:commandLink>
                                            <p:commandLink   update="treeActividades,:contenido:datos:avance,:contenido:datos:faltante,:contenido:msm"  title="#{msg['lbl.desactivar']}"  onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" rendered="#{administrarActividades.renderedEliminar(node,sessionEstudianteUsuario.estudianteUsuario.usuario,sessionProyectosAutor.autorProyecto.proyectoId)}" onclick="if (!confirm('¿#{msg['lbl.confirmarEliminar']}?'))
                                                        return false;" action="#{administrarActividades.desactivar(node,sessionProyectosAutor.autorProyecto.proyectoId.cronograma,sessionEstudianteUsuario.estudianteUsuario.usuario)}" >
                                                <p:graphicImage value="/resources/img/icon_deletelink.gif"/>
                                                <f:param name="1" value="eliminar-dlg"/>
                                            </p:commandLink>
                                            <p:commandLink  title="#{msg['lbl.activar']}" update="treeActividades,:contenido:datos:avance,:contenido:datos:faltante,:contenido:msm" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" rendered="#{administrarActividades.renderedHabilitar(node,sessionEstudianteUsuario.estudianteUsuario.usuario)}" onclick="if (!confirm('¿#{msg['lbl.confirmHabilitarNivel']}?'))
                                                        return false;" action="#{administrarActividades.desactivar(node,sessionProyectosAutor.autorProyecto.proyectoId.cronograma,sessionEstudianteUsuario.estudianteUsuario.usuario)}" >
                                                <p:graphicImage value="/resources/img/icon_success.gif"/>
                                                <f:param name="1" value="autor"/>
                                            </p:commandLink>
                                        </h:panelGrid>
                                    </p:treeNode>
                                </p:tree>
                                <f:facet name="footer">
                                    <h:panelGrid id="crearActividad" columns="1">
                                        <p:commandButton update=":dlgActividad,:editarActividad,:contenido:msm"  onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" rendered="#{administrarActividades.renderedCrearPorAutorProyecto}" value="#{msg['lbl.crear']}" action="#{administrarActividades.crear(sessionEstudianteUsuario.estudianteUsuario.usuario,sessionProyectosAutor.autorProyecto.proyectoId)}" icon="ui-icon-newwin">
                                            <f:param name="1" value="crear-dlg"/>
                                        </p:commandButton>
                                    </h:panelGrid>  
                                </f:facet>
                            </p:panel>
                            <p:panel id="pnlConsultaActividades" rendered="#{administrarActividades.renderedBuscar==false}">
                                <p:panel toggleable="true" header="#{msg['lbl.buscar']} #{msg['lbl.por']} #{msg['lbl.criterio']}">
                                    <h:panelGrid styleClass="panelgrid" rowClasses="rowpanelgrid" columnClasses="col-sm-10,col-sm-2" columns="2">
                                        <p:inputText style="text-transform: none" value="#{administrarActividades.criterioConsulta}" placeholder="#{msg['lbl.buscar']}"/> 
                                        <p:commandButton onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" value="#{msg['lbl.buscar']}" icon="ui-icon-search" update="dgActividadesConsulta" action="#{administrarActividades.consultaActividades(administrarActividades.criterioConsulta,sessionProyectosAutor.autorProyecto.proyectoId.cronograma)}"/>
                                    </h:panelGrid>
                                </p:panel>
                                <p:panel>
                                    <p:dataGrid id="dgActividadesConsulta" var="act" value="#{administrarActividades.actividadesConsulta}" paginator="true" columns="1" rows="5">
                                        <p:panel>
                                            <h:outputLabel  value="#{act.nombre}"/>

                                        </p:panel>
                                    </p:dataGrid>
                                </p:panel>
                            </p:panel>
                        </p:panel>
                    </p:tab>
                    <p:tab id="documentos" title="#{msg['lbl.documentos']}">
                        <p:panel toggleable="true" header="#{msg['lbl.buscar']} #{msg['lbl.por']} #{msg['lbl.criterio']}">
                            <h:panelGrid styleClass="panelgrid" rowClasses="rowpanelgrid"  columns="1">
                                <p:commandButton onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" value="#{msg['lbl.buscar']}" icon="ui-icon-search" update="tblDocumentos" action="#{administrarDocumentosProyecto.buscarPorAutor(sessionProyectosAutor.autorProyecto.proyectoId)}"/>
                            </h:panelGrid>
                        </p:panel>
                        <br/>
                        <p:panel header="#{msg['lbl.documentos']}" toggleable="true">
                            <p:dataTable id="tblDocumentos" rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'even-row' : 'odd-row'}" rowIndexVar="rowIx"  var="doc" rowKey="#{doc.catalogoDocumentoProyectoId.nombre}" selection="#{doc}" selectionMode="single" paginator="true" rows="8" value="#{administrarDocumentosProyecto.documentoProyectosPorAutor}">
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msg['lbl.descargar']}"/>
                                    </f:facet> 
                                    <p:commandLink action="#{administrarDocumentosProyecto.downloadDocumento(doc)}" ajax="false">
                                        <p:graphicImage value="/resources/img/pdf.png"/>
                                    </p:commandLink> 
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msg['lbl.size']}"/>
                                    </f:facet>
                                    <h:outputLabel value="#{administrarDocumentosProyecto.obtenerSizeKB(doc)}"/>
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msg['lbl.tipo']}"/>
                                    </f:facet>
                                    <h:outputLabel value="#{doc.tipoArchivo}"/>
                                </p:column>
                                <p:column sortBy="#{doc.catalogoDocumentoProyectoId.nombre}" rendered="#{administrarDocumentosProyecto.renderedEditar}">
                                    <f:facet name="header">
                                        <h:outputText value="#{msg['lbl.documento']}"/>
                                    </f:facet>
                                    <p:commandLink  onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" value="#{doc.catalogoDocumentoProyectoId.nombre}" update=":editarDocumentoProyecto,:dlgEditarDocumentoProyecto,:contenido:msm" action="#{administrarDocumentosProyecto.editar(doc,sessionEstudianteUsuario.estudianteUsuario.usuario)}">
                                        <f:param name="1" value="editar-dlg"/>
                                    </p:commandLink>
                                </p:column>
                                <p:column rendered="#{administrarDocumentosProyecto.renderedEliminar}">
                                    <f:facet name="header">
                                        <h:outputText value="#{msg['lbl.eliminar']}"/>
                                    </f:facet> 
                                    <p:commandButton title="remover"  onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" icon="ui-icon-trash" onclick="if (!confirm('¿#{msg['lbl.confirmarEliminar']}?'))
                                                return false;" update=":contenido:datos:tblDocumentos,:contenido:msm" actionListener="#{administrarDocumentosProyecto.eliminar(doc,sessionProyectosAutor.autorProyecto.proyectoId,sessionEstudianteUsuario.estudianteUsuario.usuario)}"/>
                                </p:column>
                            </p:dataTable>
                            <f:facet name="footer">
                                <h:panelGrid styleClass="pnl-botones" id="crearDocumentoProyecto">
                                    <p:commandButton value="#{msg['lbl.crear']}" id="pr"  onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" icon="ui-icon-newwin" rendered="#{administrarDocumentosProyecto.renderedCrear}" update=":editarDocumentoProyecto,:dlgEditarDocumentoProyecto,:contenido:msm" action="#{administrarDocumentosProyecto.crear(sessionEstudianteUsuario.estudianteUsuario.usuario)}">
                                        <f:param name="1" value="crear-dlg"/>
                                    </p:commandButton>
                                </h:panelGrid>
                            </f:facet>
                        </p:panel> 
                    </p:tab>
                    <p:tab id="directores" title="#{msg['lbl.directores']}">
                        <p:panel header="#{msg['lbl.buscar']} #{msg['lbl.por']} #{msg['lbl.criterio']}" toggleable="true">
                            <h:panelGrid columns="1" styleClass="panelgrid" rowClasses="rowpanelgrid" >
                                <p:commandButton value="#{msg['lbl.buscar']}" icon="ui-icon-search"  onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" update="dgDirectores" action="#{administrarDirectoresProyecto.historialDirectores}"/>
                            </h:panelGrid>
                        </p:panel>
                        <br/>
                        <p:panel header="#{msg['lbl.directores']}" toggleable="true">
                            <p:dataGrid id="dgDirectores" rowIndexVar="rowIx"  var="director" value="#{administrarDirectoresProyecto.historialDirectores}" 
                                        paginatorPosition="bottom" paginator="true" columns="1" rows="2">
                                <p:panel header="#{msg['lbl.informacion']} #{msg['lbl.director']}" toggleable="true">
                                    <div class="row-fluid">
                                        <div class="col-sm-2">
                                            <p:graphicImage id="foto" styleClass="img-thumbnail" cache="false"  height="100" width="100" value="/AppServlet?id=#{director.directorId.docenteCarrera.docenteId.persona.id}&amp;entity=Persona"/>
                                        </div>
                                        <div class="col-sm-10">
                                            <h:panelGrid styleClass="panelgrid" rowClasses="rowpanelgrid" columns="2">
                                                <h:outputLabel value="#{msg['lbl.nombres']}"/>
                                                <h:outputText value="#{director.directorId.docenteCarrera.docenteId.persona.nombres}"/>
                                                <h:outputLabel value="#{msg['lbl.apellidos']}"/>
                                                <h:outputText value="#{director.directorId.docenteCarrera.docenteId.persona.apellidos}"/>
                                                <h:outputLabel value="#{msg['lbl.email']}"/>
                                                <h:outputText value="#{director.directorId.docenteCarrera.docenteId.persona.email}"/>
                                            </h:panelGrid>
                                        </div>
                                    </div>
                                </p:panel>
                            </p:dataGrid>
                        </p:panel>
                    </p:tab>
                    <p:tab  title="#{msg['lbl.tribunales']}">
                        <p:panel header="#{msg['lbl.tribunales']}" toggleable="true">
                            <p:dataGrid  value="#{sessionProyectosAutor.autorProyecto.proyectoId.tribunales}"
                                         id="dgTribunalesDocente" var="tribunal" columns="1" rows="5" paginator="true"
                                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
                                         emptyMessage="#{msg['lbl.table.empty']}">
                                <p:panel rendered="#{tribunal.esActivo==true}" style="background:#fff" >
                                    <p:dataGrid  value="#{tribunal.evaluacionTribunalList}"
                                                 id="dgEvaluaciones" var="evaluacion" columns="1" rows="5" paginator="true" paginatorPosition="bottom"
                                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
                                                 emptyMessage="#{msg['lbl.table.empty']}">
                                        <p:panel toggleable="true"  style="background:#333;" >
                                            <f:facet name="header">
                                                <h:outputText value="#{evaluacion.catalogoEvaluacionId.nombre}"/>
                                            </f:facet>
                                            <div class="row-fluid">
                                                <div class="col-sm-3">
                                                    <p:panel >
                                                        <h:panelGrid styleClass="panelgrid" columns="2" columnClasses="col-sm-1,col-sm-11" rowClasses="rowpanelgrid">
                                                            <h:outputLabel value="#{msg['lbl.nota']}:"/>
                                                            <h:outputText value="#{evaluacion.nota}"/>
                                                            <h:outputText style="color: red;font-weight: bolder" rendered="#{evaluacion.rangoEquivalenciaId.equivalenciaId.id==1}" value="#{evaluacion.rangoEquivalenciaId.equivalenciaId.nombre}"/>
                                                            <h:outputText style="color: #2aabd2;font-weight: bolder" rendered="#{evaluacion.rangoEquivalenciaId.equivalenciaId.id==2}" value="#{evaluacion.rangoEquivalenciaId.equivalenciaId.nombre}"/>
                                                            <h:outputText style="color: yellowgreen;font-weight: bolder" rendered="#{evaluacion.rangoEquivalenciaId.equivalenciaId.id==3}" value="#{evaluacion.rangoEquivalenciaId.equivalenciaId.nombre}"/>
                                                            <h:outputText style="color: #009933;font-weight: bolder" rendered="#{evaluacion.rangoEquivalenciaId.equivalenciaId.id==4}" value="#{evaluacion.rangoEquivalenciaId.equivalenciaId.nombre}"/>
                                                        </h:panelGrid>
                                                    </p:panel>
                                                    <br/>
                                                </div>
                                                <div class="col-sm-9">
                                                    <p:panel header="#{msg['lbl.calificaciones']}" toggleable="true">
                                                        <p:dataGrid  value="#{evaluacion.calificacionMiembros}"
                                                                     id="dgCalificacionMiembros" var="cm" columns="1" rows="10" paginator="true"
                                                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
                                                                     paginatorPosition="bottom"
                                                                     emptyMessage="#{msg['lbl.table.empty']}">
                                                            <p:panel header="#{msg['lbl.miembro']}: #{cm.id}" toggleable="true">
                                                                <p:panel header="#{msg['lbl.cambios']}" toggleable="true">
                                                                    <p:dataGrid  value="#{cm.sugerenciaCalificacionMiembros}"
                                                                                 id="dgSugerencias" var="sugerencia" columns="1" rows="10" paginator="true"
                                                                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
                                                                                 paginatorPosition="bottom"
                                                                                 emptyMessage="#{msg['lbl.table.empty']}">
                                                                        <h:panelGrid style="background: #fff" columns="2" columnClasses="col-sm-3,col-sm-9" rowClasses="rowpanelgrid" styleClass="panelgrid">
                                                                            <p:outputLabel value="#{sugerencia.descripcion}"/>
                                                                        </h:panelGrid>
                                                                    </p:dataGrid>
                                                                </p:panel>
                                                                <br/>
                                                                <h:panelGrid style="background: #333!important" columns="2" columnClasses="col-sm-1,col-sm-11" styleClass="panelgrid">
                                                                    <h:outputLabel style="color:#fff" value="#{msg['lbl.nota']}:"/>
                                                                    <p:outputLabel style="color:#fff" value="#{cm.nota}" rendered="#{administrarCalificacionMiembro.renderedEditar==false}"/>
                                                                </h:panelGrid>
                                                            </p:panel>
                                                        </p:dataGrid>
                                                    </p:panel>
                                                </div>
                                            </div>
                                        </p:panel>
                                    </p:dataGrid>
                                </p:panel>
                            </p:dataGrid>
                        </p:panel>
                    </p:tab>
                </p:tabView>
            </ui:define>
            <ui:define name="dlgs">
                <p:dialog id="dlgBajarNivelActividad" styleClass="modal-sm" header="#{msg['lbl.seleccionar']} #{msg['lbl.actividad']}" widgetVar="dlgBajarNivelActividad"  modal="true"  >
                    <h:form id="seleccionarActividad">
                        <h:panelGrid styleClass="panelgrid" columns="2" columnClasses="col-sm-3,col-sm-9">
                            <h:outputLabel value="#{msg['lbl.actividades']}"/>
                            <p:selectOneMenu value="#{administrarActividades.actividadPadre}">
                                <f:selectItems value="#{administrarActividades.listadoActividadesPorAutorProyecto()}"/>
                            </p:selectOneMenu>
                        </h:panelGrid>
                        <br/>
                        <h:panelGrid>
                            <p:commandButton value="#{msg['lbl.grabar']}" update=":contenido:datos:treeActividades" icon="ui-icon-disk" action="#{administrarActividades.confirmarBajarNivel(sessionActividad.actividad,sessionProyectosAutor.autorProyecto.proyectoId.cronograma,sessionEstudianteUsuario.estudianteUsuario.usuario)}">
                                <f:param name="1" value="autor"/>
                            </p:commandButton>
                        </h:panelGrid>
                    </h:form>
                </p:dialog>

                <h:form id="editarDocumentoExpediente">
                    <p:dialog  header="#{msg['lbl.editar']} #{msg['lbl.documento']}"  rendered="#{administrarDocumentosExpediente.renderedDlgEditar}" widgetVar="dlgEditarDocumentoExpediente" modal="true" styleClass="modal-lg" >
                        <p:messages id="msm" showDetail="true" showSummary="true"/>
                        <div class="row">
                            <div class="col-sm-4">
                                <p:media value="/ImageServlet?id=#{sessionDocumentoExpediente.documentoExpediente.id}&amp;entity=DocumentoExpediente" player="pdf" width="100%" height="250"/>
                                <br/>
                                <h:panelGrid class="pnl-botones">
                                    <p:commandButton value="#{msg['lbl.subir']}" icon="ui-icon-circle-arrow-s" onstart="PF('dlgLoading').show();" oncomplete="PF('dlgLoading').hide()" onclick="PF('dlgSubirDocumentoExpediente').show();"/>
                                </h:panelGrid>
                            </div>
                            <div class="col-sm-8">
                                <h:panelGrid styleClass="panelgrid" rowClasses="rowpanelgrid" columnClasses="col-sm-1,col-sm-10,col-sm-1" columns="3">
                                    <h:outputLabel value="#{msg['lbl.descripcion']}:"/>
                                    <p:inputTextarea id="descripcion" required="true" requiredMessage="#{msg['lbl.descripcion']} #{msg['lbl.obligatorio']}." cols="40" rows="5" value="#{sessionDocumentoExpediente.documentoExpediente.descripcion}">
                                        <p:ajax event="keyup" update="msmDescripcion" />
                                        <p:ajax event="change" update="@this,msm"/>
                                    </p:inputTextarea>
                                    <p:message id="msmDescripcion" display="icon" for="descripcion"/>
                                    <h:outputLabel value="#{msg['lbl.categoria']}:"/>
                                    <p:selectOneMenu id="catalogo" value="#{administrarDocumentosExpediente.catalogoDocumentoExpediente}" required="true" requiredMessage="#{msg['lbl.categoria']} #{msg['lbl.obligatorio']}.">
                                        <!-- TODO: update below reference to list of available items-->
                                        <f:selectItems value="#{administrarDocumentosExpediente.listadoCatalogos()}"/>
                                    </p:selectOneMenu>
                                </h:panelGrid>
                            </div>
                        </div>
                        <br/>
                        <h:panelGrid styleClass="pnl-botones">
                            <p:commandButton value="#{msg['lbl.agregar']}" icon="ui-icon-circle-plus" onstart="PF('dlgLoading').show();" oncomplete="PF('dlgLoading').hide()" update=":editarExpediente:tblDocumentos,:editarExpediente:msm,msm" action="#{administrarDocumentosExpediente.agregar(sessionDocumentoExpediente.documentoExpediente)}">
                                <f:param name="1" value="agregar-dlg"/>
                            </p:commandButton>
                        </h:panelGrid>
                    </p:dialog>
                </h:form>
                <!--**************************************************************DIALOGO ACTIVIDAD****************************************************-->
                <p:dialog id="dlgActividad" header="#{msg['lbl.editar']} #{msg['lbl.actividad']}"  styleClass="modal-md"  widgetVar="dlgEditarActividad"  modal="true" 
                          showEffect="clip" hideEffect="fold" closeOnEscape="true" >
                    <h:form id="editarActividad">
                        <p:messages id="msm"/>
                        <p:panel rendered="#{administrarActividades.renderedDlgEditar}">
                            <p:tabView id="tabViewDatosActividad">
                                <p:ajax event="tabChange" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" update="dgDocumentosActividad,crearDocumentos" listener="#{administrarActividades.onTabChange}"/>
                                <p:tab title="#{msg['lbl.informacion']} #{msg['lbl.inicio']}">
                                    <h:panelGrid columns="3" styleClass="panelgrid" rowClasses="rowpanelgrid" columnClasses="col-sm-3,col-sm-8,col-lg-1">
                                        <h:outputLabel value="#{msg['lbl.fecha']} #{msg['lbl.inicio']} #{msg['lbl.limit']}"/>
                                        <h:outputText value="#{administrarActividades.fechaInicioLimit}">
                                            <f:convertDateTime pattern="EEEE dd MMMM yyyy"/>
                                        </h:outputText>
                                        <h:inputHidden/>
                                        <h:outputLabel value="#{msg['lbl.fechaCulminación']} #{msg['lbl.limit']}"/>
                                        <h:outputText value="#{administrarActividades.fechaFinLimit}">
                                            <f:convertDateTime pattern="EEEE dd MMMM yyyy"/>
                                        </h:outputText>
                                        <h:inputHidden/>
                                        <h:outputLabel value="#{msg['lbl.tipo']}:"  />
                                        <h:outputText value="#{sessionActividad.actividad.tipoActividadId.nombre}"/>
                                        <h:inputHidden/>
                                        <h:outputLabel  value="#{msg['lbl.nombre']}:"  />
                                        <p:inputTextarea style="text-transform: none" id="nombre" value="#{sessionActividad.actividad.nombre}" title="#{msg['lbl.nombre']}" required="true" requiredMessage="#{msg['lbl.nombre']} #{msg['lbl.obligatorio']}.">
                                            <p:ajax event="keyup" update="msmNombre"/>
                                        </p:inputTextarea>
                                        <p:message id="msmNombre" display="icon" for="nombre"/>
                                        <h:outputLabel  value="#{msg['lbl.descripcion']}:"  />
                                        <p:inputTextarea style="text-transform: none"  id="descripcion" value="#{sessionActividad.actividad.observacion}" title="#{msg['lbl.descripcion']}" required="true" requiredMessage="#{msg['lbl.descripcion']} #{msg['lbl.obligatorio']}.">
                                            <p:ajax event="keyup" update="msmDescripcion"/>
                                        </p:inputTextarea>
                                        <p:message id="msmDescripcion" display="icon" for="descripcion"/>
                                        <h:outputLabel value="#{msg['lbl.fecha']} #{msg['lbl.inicio']}"/>
                                        <p:calendar  id="fecha"  navigator="true" locale="#{msg['lbl.lenguajeCalendar']}"  pattern="dd/MM/yyyy hh:mm:ss" value="#{sessionActividad.actividad.fechaInicio}" title="#{msg['lbl.fecha']} #{msg['lbl.inicio']}" required="true" requiredMessage="#{msg['lbl.fecha']} #{msg['lbl.inicio']} #{msg['lbl.fecha']} #{msg['lbl.obligatorio']}.">
                                            <p:ajax event="dateSelect" update="msmFecha"/>
                                            <p:ajax event="dateSelect" update=":editarActividad:msm,fechaFin,duracion,porcentaje" listener="#{administrarActividades.calculaDuracionActividad(sessionActividad.actividad, sessionProyectosAutor.autorProyecto.proyectoId.cronograma)}"/>
                                        </p:calendar>
                                        <p:message id="msmFecha" display="icon" for="fecha"/>
                                        <h:outputLabel value="#{msg['lbl.fechaCulminación']}"/>
                                        <p:calendar  id="fechaFin"  navigator="true" locale="#{msg['lbl.lenguajeCalendar']}" pattern="dd/MM/yyyy hh:mm:ss" value="#{sessionActividad.actividad.fechaCulminacion}" title="#{msg['lbl.fechaCulminación']}" required="true" requiredMessage="#{msg['lbl.fechaCulminación']} #{msg['lbl.obligatorio']}.">
                                            <p:ajax event="dateSelect" update="msmFechaFin"/>
                                            <p:ajax event="dateSelect" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" update=":editarActividad:msm,@this,duracion,porcentaje" listener="#{administrarActividades.calculaDuracionActividad(sessionActividad.actividad,sessionProyectosAutor.autorProyecto.proyectoId.cronograma)}"/>
                                        </p:calendar>
                                        <p:message id="msmFechaFin" display="icon" for="fechaFin"/>
                                        <h:outputLabel value="#{msg['lbl.duracion']}"/>
                                        <h:outputLabel id="duracion" value="#{sessionActividad.actividad.duracion} #{msg['lbl.dias']}"/>
                                        <h:inputHidden/>
                                        <h:outputLabel value="%"/>
                                        <h:outputLabel id="porcentaje" value="#{sessionActividad.actividad.porcentajeDuracion}%"/>
                                        <h:inputHidden/>
                                    </h:panelGrid>  
                                </p:tab>
                                <p:tab id="tabDocumentos-autor" title="#{msg['lbl.documentos']}" rendered="#{administrarDocumentosActividad.renderedBuscar}">
                                    <p:panel>
                                        <p:dataGrid value="#{administrarDocumentosActividad.documentosActividad}"
                                                    id="dgDocumentosActividad" var="doc" columns="1" rows="2" paginator="true"
                                                    paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
                                                    emptyMessage="#{msg['lbl.table.empty']}.">
                                            <p:panel header="#{msg['lbl.documento']}" toggleable="true">
                                                <div class="row-fluid">
                                                    <div class="col-sm-6">
                                                        <p:media width="100%" styleClass="img-thumbnail" height="100%" player="pdf" value="/AppServlet/?id=#{doc.id}&amp;entity=DocumentoActividad"/>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <h:panelGrid styleClass="panelgrid" style="background: #f4f4f4" rowClasses="rowpanelgrid" columnClasses="col-sm-4,col-sm-8" columns="2">
                                                            <h:outputLabel value="#{msg['lbl.size']}"/>
                                                            <h:outputText value="#{administrarDocumentosActividad.obtenerSizeKB(doc)}"/>
                                                            <h:outputLabel value="#{msg['lbl.tipo']}"/>
                                                            <h:outputText value="#{doc.tipoArchivo}"/>
                                                        </h:panelGrid>
                                                    </div>
                                                </div>
                                                <f:facet name="footer">
                                                    <h:panelGrid columns="3">
                                                        <p:commandButton icon="ui-icon-check-w"  rendered="#{administrarDocumentosActividad.renderedSeleccionar}" onclick="if (!confirm('¿#{msg['lbl.confirmarSeleccionar']}?'))
                                                                    return false;" update="@form" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" action="#{administrarDocumentosActividad.seleccionarDocumento(doc,sessionEstudianteUsuario.estudianteUsuario.usuario,sessionProyectosAutor.autorProyecto.proyectoId)}"  />
                                                        <p:commandButton update=":editarDocumentoActividad,:dlgEditarDocumentoActividad" onstart="PF('dlgLoading').show()" rendered="#{administrarDocumentosActividad.renderedEditar}" oncomplete="PF('dlgLoading').hide()" action="#{administrarDocumentosActividad.editar(doc,sessionEstudianteUsuario.estudianteUsuario.usuario,sessionActividad.actividad,sessionProyectosAutor.autorProyecto.proyectoId)}" icon="ui-icon-pencil"/>
                                                        <p:commandButton update="@form" rendered="#{administrarDocumentosActividad.renderedEliminar}" onclick="if (!confirm('¿#{msg['lbl.confirmarEliminar']}?'))
                                                                    return false;" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" action="#{administrarDocumentosActividad.remover(doc,sessionEstudianteUsuario.estudianteUsuario.usuario,sessionProyectosAutor.autorProyecto.proyectoId)}" icon="ui-icon-trash"/>
                                                    </h:panelGrid>
                                                </f:facet>
                                            </p:panel>
                                        </p:dataGrid>
                                        <f:facet name="footer">
                                            <h:panelGrid id="crearDocumentos" >
                                                <p:commandButton rendered="#{administrarDocumentosActividad.renderedCrear}" icon="ui-icon-newwin" value="#{msg['lbl.crear']}" update=":editarDocumentoActividad" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" action="#{administrarDocumentosActividad.crear(sessionEstudianteUsuario.estudianteUsuario.usuario,sessionActividad.actividad,sessionProyectosAutor.autorProyecto.proyectoId)}"/>
                                            </h:panelGrid>
                                        </f:facet>
                                    </p:panel>
                                </p:tab>

                                <p:tab id="tabRevisiones" title="#{msg['lbl.revisiones']}">
                                    <p:poll interval="#{administrarConfiguraciones.intervaloActualizaciones()}" listener="#{administrarRevisiones.buscarPorAutor('', sessionActividad.actividad,sessionEstudianteUsuario.estudianteUsuario.usuario)}" update="dgRevisiones"/>
                                    <p:panel header="#{msg['lbl.revisiones']}">
                                        <p:dataGrid id="dgRevisiones" value="#{administrarRevisiones.revisionesPorAutor}" var="revision" rows="4" columns="1"  paginator="true"
                                                    rowIndexVar="rowIx" emptyMessage="#{msg['lbl.table.empty']}">
                                            <p:panel header="#{msg['lbl.revisado']}: #{administrarConfiguraciones.date(revision.fecha)} #{msg['lbl.desde']}: #{administrarConfiguraciones.time(revision.horaInicio)} #{msg['lbl.hasta']}: #{administrarConfiguraciones.time(revision.horaFin)}" toggleable="true">
                                                <h:panelGrid styleClass="panelgrid"  rowClasses="rowpanelgrid" columnClasses="col-sm-2,col-sm-10" columns="2">
                                                    <h:outputLabel value="#{msg['lbl.observacion']}"/>
                                                    <h:outputText  value="#{revision.observacion}"/>
                                                    <h:outputLabel value="#{msg['lbl.sugerencia']}"/>
                                                    <h:outputText id="sugerencia" value="#{revision.sugerencia}"/>
                                                </h:panelGrid>
                                            </p:panel>
                                        </p:dataGrid>
                                    </p:panel>
                                </p:tab>
                            </p:tabView>
                            <br/>
                            <f:facet name="footer">
                                <h:panelGrid columns="2">
                                    <p:commandButton update="@form,:contenido:datos:treeActividades,:contenido:datos:avance, :contenido:datos:faltante" value="#{msg['lbl.grabar']}" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" action="#{administrarActividades.grabar(sessionActividad.actividad,sessionProyectosAutor.autorProyecto.proyectoId.cronograma,sessionEstudianteUsuario.estudianteUsuario.usuario)}"  icon="ui-icon-disk">
                                        <f:param  name="1" value="grabar-editar-dlg" />    
                                        <f:param  name="2" value="estudiante" />
                                    </p:commandButton>
                                </h:panelGrid>
                            </f:facet>
                        </p:panel>
                    </h:form>
                </p:dialog>

                <!--*******************************************EDITAR DOCUMENTO ACTIVIDAD*****************************************************-->
                <p:dialog id="dlgEditarDocumentoActividad" header="#{msg['lbl.subir']}" widgetVar="dlgEditarDocumentoActividad" modal="true" styleClass="modal-sm" >
                    <h:form id="editarDocumentoActividad">  
                        <h:panelGrid styleClass="panelgrid">
                            <p:fileUpload multiple="false" fileUploadListener="#{administrarDocumentosActividad.handleFileUpload}" 
                                          update=":editarActividad:msm,:editarActividad:tabViewDatosActividad:dgDocumentosActividad"  mode="advanced"  
                                          allowTypes="/(\.|\/)(pdf)$/" sizeLimit="#{administrarConfiguraciones.tamanioPermitidoArchivos}" invalidFileMessage="#{msg['lbl.invalidTypeFileMessage']}"
                                          cancelLabel="#{msg['lbl.cancelar']}"  invalidSizeMessage="#{msg['lbl.fileLimitMessage']}"  label="#{msg['lbl.seleccionar']}" uploadLabel="#{msg['lbl.subir']}">
                                <f:attribute name="1" value="autor" />
                            </p:fileUpload>
                        </h:panelGrid>
                    </h:form>
                </p:dialog>
                <!--***************************************************DIALOGO EDITAR DOCUMENTO PROYECTO****************************************************************-->
                <p:dialog id="dlgEditarDocumentoProyecto" widgetVar="dlgEditarDocumentoProyecto"  header="#{msg['lbl.editar']} #{msg['lbl.documento']}" styleClass="modal-md" modal="true" >
                    <h:form id="editarDocumentoProyecto" >
                        <p:panel rendered="#{administrarDocumentosProyecto.renderedDlgEditar}">
                            <p:messages id="msm"/>
                            <div class="row-fluid">
                                <div class="col-sm-6">
                                    <p:panel header="#{msg['lbl.documento']}" toggleable="true">
                                        <p:media styleClass="img-thumbnail" value="/AppServlet?id=#{sessionDocumentoProyecto.documentoProyectoSeleccionado.id}&amp;entity=DocumentoProyecto" player="pdf" width="100%" height="250"/>
                                        <br/>
                                        <h:panelGrid styleClass="pnl-botones">
                                            <p:commandButton value="#{msg['lbl.subir']}" icon="ui-icon-refresh" onclick="PF('dlgSubirDocumentoProyecto').show();" />        
                                        </h:panelGrid>
                                    </p:panel>
                                </div>
                                <div class="col-sm-6">
                                    <p:panel header="#{msg['lbl.informacion']}" toggleable="true">
                                        <h:panelGrid style="background: #f4f4f4" styleClass="panelgrid"  rowClasses="rowpanelgrid" columnClasses="col-sm-2,col-sm-10" columns="2">
                                            <h:outputLabel value="#{msg['lbl.categoria']}:" for="catDoc" />
                                            <p:selectOneMenu id="catDoc" value="#{administrarDocumentosProyecto.catalogoDocumentoProyecto}" >
                                                <f:selectItems value="#{administrarCatalogoDocumentoProyecto.buscarActivos()}"/>
                                            </p:selectOneMenu>
                                        </h:panelGrid>
                                    </p:panel>
                                </div>
                            </div>
                            <br/> 
                            <h:panelGrid styleClass="pnl-botones" columns="1">
                                <p:commandButton  value="#{msg['lbl.grabar']}" update=":contenido:datos:tblDocumentos,msm" icon="ui-icon-disk" onstart="PF('dlgLoading').show();" oncomplete="PF('dlgLoading').hide()" action="#{administrarDocumentosProyecto.grabar(sessionDocumentoProyecto.documentoProyectoSeleccionado,sessionProyectosAutor.autorProyecto.proyectoId,sessionEstudianteUsuario.estudianteUsuario.usuario)}">
                                    <f:param name="1" value="grabar-dlg" />
                                </p:commandButton>
                            </h:panelGrid>
                        </p:panel>
                    </h:form>
                </p:dialog>
                <!--************************************************************DIALOGO SUBIR DOCUMENTO PROYECTO***********************************************************-->
                <p:dialog widgetVar="dlgSubirDocumentoProyecto" header="#{msg['lbl.subir']} #{msg['lbl.documento']}" modal="true" >
                    <h:form id="subirDocumentoProyecto" enctype="multipart/form-data">
                        <p:fileUpload fileUploadListener="#{administrarDocumentosProyecto.handleFileUpload}"  
                                      update=":editarDocumentoProyecto:msm"  multiple="true"
                                      allowTypes="/(\.|\/)(pdf)$/" sizeLimit="#{administrarConfiguraciones.tamanioPermitidoArchivos}" invalidFileMessage="#{msg['lbl.invalidTypeFileMessage']}"
                                      invalidSizeMessage="#{msg['lbl.fileLimitMessage']}"
                                      required="true"  oncomplete="PF('dlgSubirDocumentoProyecto').hide()" cancelLabel="#{msg['lbl.cancelar']}"  label="#{msg['lbl.seleccionar']}" uploadLabel="#{msg['lbl.subir']}"/> 

                    </h:form>
                </p:dialog>
            </ui:define>
        </ui:composition>

    </body>
</html>
