<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <body>

        <ui:composition template="./portada.xhtml">

            <ui:define name="title">
                <h:outputText value="#{msg['lbl.directorio']} #{msg['lbl.proyectos']}"/>
            </ui:define>
            <ui:define name="top">
                <p:menubar>
                    <p:menuitem icon="ui-icon-home" value="#{msg['lbl.inicio']}"  action="pretty:portada"></p:menuitem>
                    <f:facet name="options">
                        <h:panelGrid columns="1">
                            <p:commandButton value="#{msg['lbl.regresar']}" icon="ui-icon-arrowreturnthick-1-w" onclick="regresar()"/>
                        </h:panelGrid>
                    </f:facet>
                </p:menubar>
            </ui:define>
            <ui:define name="content">
                <p:messages id="msm"/>
                <p:panel toggleable="true" header="#{msg['lbl.buscar']} #{msg['lbl.criterio']}">
                    <h:panelGrid styleClass="panelgrid" summary="a" rowClasses="rowpanelgrid" columnClasses="col-sm-10,col-sm-2" columns="2">
                        <p:inputText id="criterio" style="text-transform: none" value="#{viewProyectos.filtro}" placeholder="#{msg['lbl.tema']}"/>
                        <p:commandButton update="tblProyectos,msm" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" 
                                         action="#{viewProyectos.buscarWebSemantica(viewProyectos.filtro)}"
                                         value="#{msg['lbl.buscar']}" icon="ui-icon-search" />
                    </h:panelGrid>
                    <br/>
                   <h:panelGrid columns="2" columnClasses="col-sm-2,col-sm-10" styleClass="panelgrid" rowClasses="rowpanelgrid" >
                        <h:outputLabel value="#{msg['lbl.area']}" for="area"/>
                        <p:selectOneMenu id="area" value="#{viewProyectos.area}">
                            <f:selectItem itemLabel="[#{msg['lbl.seleccionar']}]"/>
                            <f:selectItems value="#{administrarAreas.listarTodo()}"/>
                            <p:ajax event="change" update=":derecha:dgCarreras"  listener="#{viewProyectos.buscarCarreras(viewProyectos.area,'')}"/>
                        </p:selectOneMenu >
                        <h:inputHidden/>
                    </h:panelGrid>
                </p:panel>
                <br/>
                <p:panel toggleable="true" header="#{msg['lbl.proyectos']}"  id="proyectos" >
                    <p:dataTable id="tblProyectos" value="#{viewProyectos.proyectos}" var="item" rows="10" paginator="true"
                                 rowIndexVar="rowIx"  rowsPerPageTemplate="10,15,20,25,30,35,40,45,50" rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'even-row' : 'odd-row'}" emptyMessage="#{msg['lbl.table.empty']}" rowKey="#{item.id}" selection="#{item}" selectionMode="single">
                        <p:column sortBy="#{item.fechaCreated}">
                            <f:facet name="header">
                                <h:outputText value="#{msg['lbl.fecha']} #{msg['lbl.creacion']}"/>
                            </f:facet>
                            <h:outputText value="#{administrarConfiguraciones.timestamp(item.fechaCreated)}" />
                        </p:column>
                        <p:column sortBy="#{item.temaActual}">
                            <f:facet name="header">
                                <h:outputText value="#{msg['lbl.tema']}"/>
                            </f:facet>
                            <p:commandLink onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" update="tblProyectos" action="#{viewProyectos.editar(item)}" value="#{item.temaActual}"/>
                        </p:column>
                        <p:column >
                            <f:facet name="header">
                                <h:outputText value="#{msg['lbl.autores']}"/>
                            </f:facet>
                            <p:commandLink  action="#{viewProyectos.editar(item)}" value="#{viewProyectos.autores(item)}"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>
            </ui:define>
            <ui:define name="right">
                <p:panel header="#{msg['lbl.carreras']}" toggleable="true">
                    <p:dataTable id="dgCarreras"  rowIndexVar="rowIx" rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'even-row' : 'odd-row'}" var="c" rowKey="#{c.nombre}" selection="#{c}" selectionMode="single" paginator="true" rows="10"  value="#{viewProyectos.carreras}">
                        <p:ajax event="rowSelect" listener="#{viewProyectos.onRowSelectCarrera}" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()"  update=":izquierda:dgLineasInvestigacionCarrera,:contenido:proyectos" />
                        <p:column filterBy="#{c.nombre}" filterMatchMode="contains" sortBy="#{c.nombre}">
                            <f:facet name="header">
                                <h:outputText value="#{msg['lbl.carrera']}"/>
                            </f:facet>
                            <p:panelGrid columns="2" columnClasses="col-sm-10,col-sm-2">
                                <h:outputText value="#{c.nombre}"/>
                                <span class="badge">#{viewProyectos.countProyectosCarrera(c)}</span>
                            </p:panelGrid>
                        </p:column> 
                    </p:dataTable>
                </p:panel>     
                <br/>
                <p:panel header="#{msg['lbl.periodosAcademicos']}">
                    <p:dataTable id="dgPeriodos"  var="p"  paginator="true" rows="5" rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'even-row' : 'odd-row'}"
                                 rowIndexVar="rowIx"  value="#{viewProyectos.listadoPeriodosAcademicos()}" rowKey="#{p.fechaInicio}" selection="#{p}" selectionMode="single">
                        <p:ajax event="rowSelect" listener="#{viewProyectos.editarPeriodo}" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()" update=":contenido:proyectos,:contenido:msm" />
                        <p:column>
                            <p:panelGrid columns="2" columnClasses="col-sm-10,col-sm-2">
                                <h:outputText value="#{msg['lbl.desde']} #{administrarConfiguraciones.date(p.fechaInicio)} #{msg['lbl.hasta']} #{administrarConfiguraciones.date(p.fechaFin)}"/>
                                <span class="badge">#{viewProyectos.countProyectosPeriodo(p)}</span>
                            </p:panelGrid>
                        </p:column>

                    </p:dataTable>
                </p:panel>
            </ui:define>
            <ui:define name="left">
                <p:panel toggleable="true" header="#{msg['lbl.lineasInvestigacion']}">
                    <p:dataTable id="dgLineasInvestigacionCarrera" rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'even-row' : 'odd-row'}" rowIndexVar="rowIx"  var="lc" rowKey="#{lc.lineaInvestigacionId.nombre}" selection="#{lc}" selectionMode="single" paginator="true" rows="8" value="#{viewProyectos.lineaInvestigacionCarreras}">
                        <p:ajax event="rowSelect"  listener="#{viewProyectos.editarLineaInvestigacion}" onstart="PF('dlgLoading').show()" oncomplete="PF('dlgLoading').hide()"  update=":contenido:proyectos,:contenido:msm" />
                        <p:column  filterBy="#{lc.lineaInvestigacionId.nombre}" filterMatchMode="contains">
                            <f:facet name="header">
                                <h:outputText value="#{msg['lbl.lineaInvestigacion']}"/>
                            </f:facet>

                            <h:outputText id="lc" value="#{lc.lineaInvestigacionId.nombre}"/>
                            <span class="badge">#{viewProyectos.countProyectosLineas(lc)}</span>    

                        </p:column>
                    </p:dataTable>
                </p:panel>
            </ui:define>
        </ui:composition>

    </body>
</html>
