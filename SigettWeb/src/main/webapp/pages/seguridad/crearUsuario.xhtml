<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <body>
        <ui:composition template="./../../principalAdmin.xhtml">
            <ui:define name="title">#{msg['lbl.crear']} #{msg['lbl.usuario']}</ui:define>
            <ui:define name="content">
                <p:messages id="msm"/>
                <p:panel header="#{msg['lbl.usuario']}" toggleable="true">
                    <h:panelGrid styleClass="panelgrid" rowClasses="rowpanelgrid" columnClasses="col-sm-3,col-sm-8,col-sm-1" columns="3">
                        <h:outputLabel value="#{msg['lbl.usuario']}:" for="username" />
                        <p:inputText id="username" validatorMessage="#{msg['lbl.formato_invalido']}" style="text-transform: none" value="#{adminUsuario.usuario.username}" title="#{msg['lbl.usuario']}" required="true" requiredMessage="#{msg['lbl.usuario']} #{msg['lbl.obligatorio']}.">
                            <p:ajax event="change" update="@this,:contenido:msm"/>
                            <p:ajax event="keyup" update="msmNombre"/>
                            <f:validateRegex pattern="^[A-Za-z0-9]{1,20}$"/>
                        </p:inputText>
                        <p:message id="msmNombre" display="icon" for="username"/>
                        <h:outputLabel value="#{msg['lbl.clave']}:" />
                        <p:password  id="password" style="text-transform: none" feedback="true" value="#{adminUsuario.usuario.password}" title="#{msg['lbl.clave']}" required="true" requiredMessage="#{msg['lbl.clave']} #{msg['lbl.obligatorio']}.">
                            <p:ajax event="change" update=":contenido:msm"/>
                            <f:validateRegex pattern="^[A-Za-z0-9]{1,20}$"/>
                        </p:password>
                        <h:inputHidden/>
                        <h:outputLabel value="#{msg['lbl.confirmar']} #{msg['lbl.clave']}:" for="Password" />
                        <p:password  id="confirmaPassword"  style="text-transform: none" feedback="true" value="#{administrarUsuarios.confirmaClave}" title="#{msg['lbl.confirmar']} #{msg['lbl.clave']}" required="true" requiredMessage="#{msg['lbl.confirmar']} #{msg['lbl.obligatorio']}.">
                            <p:ajax event="change" update=":contenido:msm"/>
                            <f:validateRegex pattern="^[A-Za-z0-9]{1,20}$"/>
                        </p:password>

                    </h:panelGrid>
                </p:panel>
                <br/>
                <p:panel header="#{msg['lbl.datos']} #{msg['lbl.usuario']}" toggleable="true">
                    <h:panelGrid rowClasses="rowpanelgrid" styleClass="panelgrid" columns="3" columnClasses="col-sm-3,col-sm-8,col-lg-1">  
                        <h:outputLabel value="#{msg['lbl.nombres']}:" for="nombres" />
                        <p:inputText id="nombres" value="#{adminUsuario.usuario.nombres}" title="#{msg['lbl.nombres']}" required="true" requiredMessage="#{msg['lbl.nombres']} #{msg['lbl.obligatorio']}.">
                            <p:ajax event="change" update="@this,:contenido:msm"/>
                        </p:inputText>
                        <p:message id="msmNombres" display="icon" for="nombres"/>
                        <h:outputLabel value="#{msg['lbl.apellidos']}:" for="apellidos" />
                        <p:inputText id="apellidos" value="#{adminUsuario.usuario.apellidos}" title="#{msg['lbl.apellidos']}" required="true" requiredMessage="#{msg['lbl.apellidos']} #{msg['lbl.obligatorio']}.">
                            <p:ajax event="change" update="@this,:contenido:msm"/>
                        </p:inputText>
                        <p:message id="msmApellidos" display="icon" for="apellidos"/>
                        <h:outputLabel value="#{msg['lbl.email']}:" for="email" />
                        <p:inputText id="email" value="#{adminUsuario.usuario.email}" title="#{msg['lbl.email']}" required="true" requiredMessage="#{msg['lbl.email']} #{msg['lbl.obligatorio']}.">
                            <p:ajax event="change" update="@this,:contenido:msm"/>
                        </p:inputText>
                        <p:message id="msmEmail" display="icon" for="email"/>
                        <h:outputLabel value="#{msg['lbl.activo']}:" for="esActivo" />
                        <p:selectBooleanCheckbox label="#{msg['lbl.activo']}" value="#{adminUsuario.usuario.esActivo}"/>
                        <h:inputHidden/>
                        <h:outputLabel value="#{msg['lbl.superUsuario']}:" for="esSuperuser" />
                        <p:selectBooleanCheckbox  value="#{adminUsuario.usuario.esSuperuser}" />
                    </h:panelGrid>
                </p:panel>
                <br/>
                <p:panel header="#{msg['lbl.roles']}" toggleable="true">
                    <h:panelGrid columns="2">
                        <p:pickList id="roles"  value="#{administrarUsuarios.rolesDualList}" var="items" itemLabel="#{items}" itemValue="#{items}" showSourceControls="true" showTargetControls="true" showCheckbox="true"
                                    showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains"  >
                            <f:facet name="sourceCaption">#{msg['lbl.roles']} #{msg['lbl.disponibles']}</f:facet>
                            <f:facet name="targetCaption">#{msg['lbl.roles']}</f:facet>
                            <p:ajax event="transfer" listener="#{administrarUsuarios.transferRolUsuarios}"></p:ajax>
                        </p:pickList>
                    </h:panelGrid>
                </p:panel>
                <br/>
                <p:panel header="#{msg['lbl.permisos']}" toggleable="true">
                    <p:pickList id="permisos"  value="#{administrarUsuarios.permisosDualList}" var="items" itemLabel="#{items}" itemValue="#{items}" showSourceControls="true" showTargetControls="true" showCheckbox="true"
                                showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains"  >
                        <f:facet name="sourceCaption">#{administrarUsuarios.numeroPermisosDisponibles}:#{msg['lbl.permisos']} #{msg['lbl.disponibles']}</f:facet>
                        <f:facet name="targetCaption">#{administrarUsuarios.numeroPermisosSeleccionados}: #{msg['lbl.permisos']}</f:facet>
                        <p:ajax event="transfer" update="@this" listener="#{administrarUsuarios.transferUsuariosPermisos}"></p:ajax>
                    </p:pickList>
                </p:panel>
                <br/>
                <p:panel header="#{msg['lbl.carreras']}" toggleable="true">
                    <h:panelGrid columns="1">
                        <p:pickList id="carreras"  value="#{administrarUsuarios.carrerasDualList}" var="items" itemLabel="#{items}" itemValue="#{items}" showSourceControls="true" showTargetControls="true" showCheckbox="true"
                                    showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains"  >
                            <f:facet name="sourceCaption">#{administrarUsuarios.numeroCarrerasDisponibles}: #{msg['lbl.carreras']} #{msg['lbl.disponibles']}</f:facet>
                            <f:facet name="targetCaption">#{administrarUsuarios.numeroCarrerasSeleccionadas}: #{msg['lbl.carreras']}</f:facet>
                            <p:ajax event="transfer" update="carreras" listener="#{administrarUsuarios.transferUsuariosCarreras}"></p:ajax>
                        </p:pickList>
                    </h:panelGrid>
                </p:panel>   
                <br/>
                <h:panelGrid styleClass="pnl-botones" columns="3">  
                    <p:commandButton value="#{msg['lbl.grabar']}" icon="ui-icon-disk" update="@form" onstart="PF('dlgLoading').show();" oncomplete="PF('dlgLoading').hide()" action="#{administrarUsuarios.guardarConClave(adminUsuario.usuario,sessionUsuario.usuario, administrarUsuarios.confirmaClave)}">
                        <f:param name="1" value="guardar" />
                        <f:param name="2" value="guardar" />
                    </p:commandButton>
                    <p:commandButton value="#{msg['lbl.grabar']} #{msg['lbl.editar']}" icon="ui-icon-disk" update="@form" onstart="PF('dlgLoading').show();" oncomplete="dlgLoading.hide()" action="#{administrarUsuarios.guardarConClave(adminUsuario.usuario,sessionUsuario.usuario,administrarUsuarios.confirmaClave)}">
                        <f:param name="1" value="guardar-editar"/>
                        <f:param name="2" value="guardar" />
                    </p:commandButton>
                    <p:commandButton value="#{msg['lbl.grabar']} #{msg['lbl.agregar']} #{msg['lbl.otro']}" update="@form" onstart="PF('dlgLoading').show();" oncomplete="dlgLoading.hide()" action="#{administrarUsuarios.guardarConClave(adminUsuario.usuario,sessionUsuario.usuario,administrarUsuarios.confirmaClave)}">
                        <f:param name="1" value="guardarCrear" />
                        <f:param name="2" value="guardarCrear"/>
                    </p:commandButton>
                </h:panelGrid>
            </ui:define>

        </ui:composition>

    </body>
</html>
