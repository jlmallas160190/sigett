<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <body>
        <ui:composition template="./../../principalAdmin.xhtml">
            <ui:define name="title">#{msg['lbl.usuario']}</ui:define>
            <ui:define name="content">
                <p:messages id="msm"/>
                <p:panel>
                    <f:facet name="header">
                        <h:panelGrid>
                            <p:commandButton value="#{msg['lbl.historial']}" update="@form" icon="ui-icon-document-w" action="#{administrarLogs.historico('Usuario', adminUsuario.usuario.id)}"/>
                        </h:panelGrid>
                    </f:facet>
                    <p:panel header="#{msg['lbl.editar']} #{msg['lbl.usuario']}" toggleable="true">
                        <h:panelGrid styleClass="panelgrid" rowClasses="rowpanelgrid" columnClasses="col-sm-3,col-sm-8,col-sm-1" columns="3">
                            <h:outputLabel value="#{msg['lbl.usuario']}:" for="username" />
                            <p:inputText id="username" style="text-transform: none" value="#{adminUsuario.usuario.username}" title="#{msg['lbl.usuario']}" required="true" requiredMessage="#{msg['lbl.usuario']} #{msg['lbl.obligatorio']}">
                                <p:ajax event="keyup" update="msmNombre"/>
                                <p:ajax event="change" update="@this,:contenido:msm"/>
                                <f:validateRegex pattern="^[A-Za-z0-9]{1,}([\s][A-Za-z0-9]{1,})*$" />
                            </p:inputText>
                            <p:message id="msmNombre" display="icon" for="username"/>
                            <h:outputLabel value="#{msg['lbl.clave']}:"/>
                            <p:commandLink  value="#{msg['lbl.cambiar']} #{msg['lbl.clave']}" action="pretty:cambiarClave"/>
                        </h:panelGrid>
                    </p:panel>   
                    <br/>
                    <p:panel header="#{msg['lbl.datos']} #{msg['lbl.usuario']}" toggleable="true">
                        <h:panelGrid styleClass="panelgrid" rowClasses="rowpanelgrid" columnClasses="col-sm-3,col-sm-8,col-sm-1" columns="3">
                            <h:outputLabel value="#{msg['lbl.nombres']}:" for="nombres" />
                            <p:inputText id="nombres" value="#{adminUsuario.usuario.nombres}" title="#{msg['lbl.nombres']}" required="true" requiredMessage="#{msg['lbl.nombres']} #{msg['lbl.obligatorio']}">
                                <p:ajax event="keyup" update="msmNombres"/>
                                <p:ajax event="change" update="@this,:contenido:msm"/>
                            </p:inputText>
                            <p:message id="msmNombres" display="icon" for="nombres"/>
                            <h:outputLabel value="#{msg['lbl.apellidos']}:" for="apellidos" />
                            <p:inputText id="apellidos" value="#{adminUsuario.usuario.apellidos}" title="#{msg['lbl.apellidos']}" required="true" requiredMessage="#{msg['lbl.apellidos']} #{msg['lbl.obligatorio']}.">
                                <p:ajax event="keyup" update="msmApellidos"/>
                                <p:ajax event="change" update="@this,:contenido:msm"/>
                            </p:inputText>
                            <p:message id="msmApellidos" display="icon" for="apellidos"/>
                            <h:outputLabel value="#{msg['lbl.email']}:" for="email" />
                            <p:inputText id="email" value="#{adminUsuario.usuario.email}" title="#{msg['lbl.email']}" required="true" requiredMessage="#{msg['lbl.email']} #{msg['lbl.obligatorio']}.">
                                <p:ajax event="keyup" update="msmEmail"/>
                                <p:ajax event="change" update="@this,:contenido:msm"/>
                            </p:inputText>
                            <p:message id="msmEmail" display="icon" for="email"/>
                            <h:outputLabel value="#{msg['lbl.activo']}:" for="esActivo" />
                            <p:selectBooleanCheckbox label="#{msg['lbl.activo']}" value="#{adminUsuario.usuario.esActivo}"/>
                            <h:inputHidden/>
                            <h:outputLabel value="#{msg['lbl.superUsuario']}:" for="esSuperuser" />
                            <p:selectBooleanCheckbox label="#{msg['lbl.superUsuario']}" value="#{adminUsuario.usuario.esSuperuser}" />
                        </h:panelGrid>
                    </p:panel> 
                    <br/>
                    <p:panel header="#{msg['lbl.roles']}" toggleable="true">
                        <p:pickList id="roles"  value="#{administrarUsuarios.rolesDualList}" var="items" itemLabel="#{items}" itemValue="#{items}" showSourceControls="true" showTargetControls="true" showCheckbox="true"
                                    showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains"  >
                            <f:facet name="sourceCaption">#{msg['lbl.roles']} #{msg['lbl.disponibles']}</f:facet>
                            <f:facet name="targetCaption">#{msg['lbl.roles']} </f:facet>
                            <p:ajax event="transfer" listener="#{administrarUsuarios.transferRolUsuarios}"></p:ajax>
                        </p:pickList>
                    </p:panel>
                    <br/>
                    <p:panel header="#{msg['lbl.permisos']}" toggleable="true">
                        <p:pickList id="permisos"  value="#{administrarUsuarios.permisosDualList}" var="items" itemLabel="#{items}" itemValue="#{items}" showSourceControls="true" showTargetControls="true" showCheckbox="true"
                                    showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains"  >
                            <f:facet name="sourceCaption">#{administrarUsuarios.numeroPermisosDisponibles}:#{msg['lbl.permisos']} #{msg['lbl.disponibles']}</f:facet>
                            <f:facet name="targetCaption">#{administrarUsuarios.numeroPermisosSeleccionados}: #{msg['lbl.permisos']}</f:facet>
                            <p:ajax event="transfer" update="@this" listener="#{administrarUsuarios.transferUsuariosPermisos}"></p:ajax>
                        </p:pickList>
                    </p:panel>
                    <br/>
                    <p:panel header="#{msg['lbl.carreras']}" toggleable="true">
                        <h:panelGrid columns="1">
                            <p:pickList id="carreras"  value="#{administrarUsuarios.carrerasDualList}" var="items" itemLabel="#{items}" itemValue="#{items}" showSourceControls="true" showTargetControls="true" showCheckbox="true"
                                        showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains"  >
                                <f:facet name="sourceCaption">#{administrarUsuarios.numeroCarrerasDisponibles}: #{msg['lbl.carreras']} #{msg['lbl.disponibles']}</f:facet>
                                <f:facet name="targetCaption">#{administrarUsuarios.numeroCarrerasSeleccionadas}: #{msg['lbl.carreras']}</f:facet>
                                <p:ajax event="transfer" update="carreras" listener="#{administrarUsuarios.transferUsuariosCarreras}"></p:ajax>
                            </p:pickList>
                        </h:panelGrid>
                    </p:panel>   
                    <f:facet name="footer">
                        <h:panelGrid columns="3">  
                            <p:commandButton value="#{msg['lbl.grabar']}" icon="ui-icon-disk" update="@form" onstart="PF('dlgLoading').show();" oncomplete="PF('dlgLoading').hide()" action="#{administrarUsuarios.guardar(adminUsuario.usuario,sessionUsuario.usuario)}">
                                <f:param name="1" value="guardar" />
                                <f:param name="2" value="guardar" />
                            </p:commandButton>
                            <p:commandButton value="#{msg['lbl.grabar']} #{msg['lbl.y']} #{msg['lbl.editar']}" icon="ui-icon-disk" update="@form" onstart="PF('dlgLoading').show();" oncomplete="PF('dlgLoading').hide()" action="#{administrarUsuarios.guardar(adminUsuario.usuario,sessionUsuario.usuario)}">
                                <f:param name="1" value="guardar-editar" />
                                <f:param name="2" value="guardar" />
                            </p:commandButton>
                            <p:commandButton value="#{msg['lbl.grabar']} #{msg['lbl.y']} #{msg['lbl.agregar']} #{msg['lbl.otro']}" update="@form" icon="ui-icon-disk" onstart="PF('dlgLoading').show();" oncomplete="PF('dlgLoading').hide()" action="#{administrarUsuarios.guardar(adminUsuario.usuario,sessionUsuario.usuario)}">
                                <f:param name="1" value="guardarCrear" />
                                <f:param name="2" value="guardar" />
                            </p:commandButton>
                        </h:panelGrid>
                    </f:facet>
                </p:panel>
            </ui:define>
        </ui:composition>
    </body>
</html>
